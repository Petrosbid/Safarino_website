{% extends 'base/base.html' %}
{% load static %}

{% block title %}داشبورد کاربری{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>داشبورد سفر</title>
        <link rel="stylesheet" href="{% static 'static_main/css/user_dashbord.css' %}">
        <link rel="stylesheet" href="{% static 'static_main/css/footer_header2.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <script src="https://cdn.lordicon.com/lordicon.js"></script>
         <script
          src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
          type="module"
        ></script>
    </head>
    <body>
        <div class="dashboard-container">
            <aside class="sidebar">
                <div class="user-info">
                {% if user.profile_picture %}
                    <img class="user-avatar" src="{{ user.profile_picture.url }}" alt="{{ user.username }}">
                {% else %}
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ user.username }}" alt="avatar">
                {% endif %}
                    <span class="user-name">
                        {% if user.first_name %}
                            {{ user.first_name }} {{ user.last_name }}
                        {% else %}
                            {{ user.username }}
                        {% endif %}
                    </span>
                    <span class="user-role">کاربر</span>
                </div>


                <a href="/trip/planner/">
                    <button class="new-trip-btn">
                        سفر جدید +
                    </button>
                </a>

                <nav class="main-nav">
                    <ul>
                        <li class="nav-item active">
                            <a href="{% url 'user_dashboard' %}">
                                <lord-icon
                                    src="https://cdn.lordicon.com/jeuxydnh.json"
                                    trigger="hover"
                                    stroke="bold"
                                    state="hover-partial-roll"
                                    colors="primary:#121331,secondary:#2b4162"
                                    style="width:35px;height:35px">
                                </lord-icon>
                                <span class="nav-text">خانه</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'active_trip' %}">
                                <lord-icon
                                    src="https://cdn.lordicon.com/onmwuuox.json"
                                    trigger="hover"
                                    stroke="bold"
                                    state="hover-jump-roll"
                                    colors="primary:#121331,secondary:#2b4162"
                                    style="width:35px;height:35px">
                                </lord-icon>
                                <span class="nav-text">سفر فعال</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'all_trips' %}">
                                <lord-icon
                                    src="https://cdn.lordicon.com/pkxwrmde.json"
                                    trigger="hover"
                                    stroke="bold"
                                    colors="primary:#121331,secondary:#2b4162"
                                    style="width:35px;height:35px">
                                </lord-icon>
                                <span class="nav-text">همه سفرها</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <form method="post" action="{% url 'logout' %}" style="margin: 0; padding: 0;">
                                {% csrf_token %}
                                <button type="submit" style="background: none; border: none; width: 100%; text-align: right; cursor: pointer; display: flex; align-items: center; padding: 0.7rem 1rem; color: var(--text-light); text-decoration: none; border-radius: var(--border-radius-md); transition: all 0.3s ease; font-size: 0.95rem;">
                                    <lord-icon
                                        src="https://cdn.lordicon.com/vfiwitrm.json"
                                        trigger="hover"
                                        stroke="bold"
                                        colors="primary:#121331,secondary:#2b4162"
                                        style="width:35px;height:35px">
                                    </lord-icon>
                                    <span class="nav-text">خروج از حساب کاربری</span>
                                </button>
                            </form>
                        </li>


                    </ul>
                </nav>

                {% comment %} <div class="sidebar-bottom">
                    <div class="weather-widget">
                        <div class="weather-icon">☀️</div>
                        <div class="weather-info">
                            <span class="temp">۳۰°</span>
                            <span class="location">رم</span>
                        </div>
                        <div class="weather-forecast">
                            <!-- Placeholder for forecast -->
                            <span>Mon</span> <span>Tue</span> <span>Wed</span> <span>Thu</span> <span>Fri</span>
                            <span>۳۱°</span> <span>۲۹°</span> <span>۳۳°</span> <span>۲۸°</span> <span>۳۲°</span>
                        </div>
                    </div>


                </div> {% endcomment %}
            </aside>
            <main class="main-content">
                <section class="content-area">
                    <div class="content-left">
                        <div class="profile-section">
                            <div class="profile-header" style="background-image: url('{% static 'static_main/images/30534307_2207_w048_n005_181b_p1_181-compressed.jpg' %}');
                             background-repeat: no-repeat;
                             background-position: center;
                             background-size: cover;">
                                 <div class="profile-avatar">
                                        {% if user.profile_picture %}
                                            <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}">
                                        {% else %}
                                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ user.username }}" alt="avatar">
                                        {% endif %}
                                        <label for="profile-picture-input" class="change-avatar-btn">
                                            <lord-icon
                                                src="https://cdn.lordicon.com/wsaaegar.json"
                                                trigger="hover"
                                                stroke="bold"
                                                colors="primary:#121331,secondary:#2b4162"
                                                style="width:25px;height:25px">
                                            </lord-icon>
                                        </label>
                                        <input type="file" id="profile-picture-input" name="profile_picture" accept="image/*" style="display: none;" onchange="updateProfilePicture(this)">
                                 </div>

                            <div class="profile-info">
                                    <h2>
                                        {% if user.first_name %}
                                            {{ user.first_name }} {{ user.last_name }}
                                        {% else %}
                                            {{ user.username }}
                                        {% endif %}
                                    </h2>
                                    <p class="user-email">{{ user.email }}</p>
                                    <p class="join-date">عضو از {{ user.date_joined|date:"Y/m/d" }}</p>
                                </div>
                            </div>
                            <div class="profile-details">
                                <form method="post" action="{% url 'update_profile' %}" enctype="multipart/form-data" class="profile-form">
                                    {% csrf_token %}
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <h3 class="section-title">اطلاعات پایه</h3>
                                        </div>
                                        <div class="form-group">
                                            <label>نام کاربری</label>
                                            <input type="text" name="username" value="{{ user.username }}" placeholder="نام کاربری خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>نام</label>
                                            <input type="text" name="first_name" value="{{ user.first_name }}" placeholder="نام خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>نام خانوادگی</label>
                                            <input type="text" name="last_name" value="{{ user.last_name }}" placeholder="نام خانوادگی خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>ایمیل</label>
                                            <input type="email" name="email" value="{{ user.email }}" placeholder="ایمیل خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>شماره موبایل</label>
                                            <input type="tel" name="phone" value="{{ user.phone_number|default:'' }}" placeholder="شماره موبایل خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>کد ملی</label>
                                            <input type="text" name="national_code" value="{{ user.national_code }}" placeholder="کد ملی خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>تاریخ تولد</label>
                                            <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}">
                                        </div>
                                        <div class="form-group">
                                            <label>جنسیت</label>
                                            <select name="gender">
                                                {% for value, label in gender_choices %}
                                                    <option value="{{ value }}" {% if user.gender == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group full-width">
                                            <label>درباره من</label>
                                            <textarea name="bio" placeholder="درباره خود بنویسید...">{{ user.bio|default:'' }}</textarea>
                                        </div>

                                        <div class="form-group full-width">
                                            <h3 class="section-title">تغییر رمز عبور</h3>
                                        </div>
                                        <div class="form-group">
                                            <label>رمز عبور فعلی</label>
                                            <input type="password" name="current_password" placeholder="رمز عبور فعلی خود را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>رمز عبور جدید</label>
                                            <input type="password" name="new_password" placeholder="رمز عبور جدید را وارد کنید">
                                        </div>
                                        <div class="form-group">
                                            <label>تکرار رمز عبور جدید</label>
                                            <input type="password" name="confirm_password" placeholder="رمز عبور جدید را مجددا وارد کنید">
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="save-btn">ذخیره تغییرات</button>
                                    </div>
                                </form>
                            </div>

                            <div class="profile-stats">
                                <div class="stat-card">
                                    <lord-icon
                                        src="https://cdn.lordicon.com/pkxwrmde.json"
                                        trigger="hover"
                                        stroke="bold"
                                        colors="primary:#121331,secondary:#2b4162"
                                        style="width:35px;height:35px">
                                    </lord-icon>
                                    <div class="stat-info">
                                        <h3>تعداد سفرها</h3>
                                        <p>{{ user_trips_count|default:"0" }}</p>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <lord-icon
                                        src="https://cdn.lordicon.com/onmwuuox.json"
                                        trigger="hover"
                                        stroke="bold"
                                        colors="primary:#121331,secondary:#2b4162"
                                        style="width:35px;height:35px">
                                    </lord-icon>
                                    <div class="stat-info">
                                        <h3>سفرهای فعال</h3>
                                        <p>{{ active_trips_count|default:"0" }}</p>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <lord-icon
                                        src="https://cdn.lordicon.com/jeuxydnh.json"
                                        trigger="hover"
                                        stroke="bold"
                                        colors="primary:#121331,secondary:#2b4162"
                                        style="width:35px;height:35px">
                                    </lord-icon>
                                    <div class="stat-info">
                                        <h3>نقاط سفر</h3>
                                        <p>{{ travel_points|default:"0" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
        <script src="{% static 'javascript/user_dashbord.js' %}"></script>
    </body>
</html>
{% endblock %}

{% block extra_js %}
<script src="{% static 'javascript/user_dashbord.js' %}"></script>
{% endblock %}